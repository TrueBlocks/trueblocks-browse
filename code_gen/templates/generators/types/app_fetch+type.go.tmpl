{{/*==============================================================*/}}

{{ $class := .Class }}
{{ $container := print $class "Container" }}
{{ $itemName := .ItemName}}
{{ $routeLower := toLower .UiRouteName }}

{{ $fetchFn := print "Fetch" $class }}

{{ $hasItems := and (gt (len $itemName) 0) true }}
{{ $isHistory := eq $class "History" -}}
{{ $isSettings := eq $class "Settings" -}}

{{ $cast := print ".([]types.Nothing)" }}
{{ if $hasItems }}
	{{ $cast = print ".([]" .ItemFullType ")" }}
{{ end }}

{{ $dest := "_" }}
{{ if and $hasItems (not $isSettings ) }}
	{{ $dest = "copy.Items" }}
{{ end }}

{{ $dataName := print "a." $routeLower }}
{{ if $isHistory }}
	{{ $dataName = $routeLower }}
{{ end }}

{{/*==============================================================*/}}

// This file is auto-generated. Edit only code inside
// of ExistingCode markers (if any).
package app

// EXISTING_CODE
// EXISTING_CODE

func (a *App) {{$fetchFn}}(first, pageSize int) *types.{{$container}} {
	// EXISTING_CODE
	// EXISTING_CODE

	filtered := {{$dataName}}.CollateAndFilter(a.filterMap){{$cast}}
	first = base.Max(0, base.Min(first, len(filtered)-1))
	last := base.Min(len(filtered), first+pageSize)
	copy, _ := {{$dataName}}.ShallowCopy().(*types.{{$container}})
	{{ $dest }} = filtered[first:last]

	return copy
}
